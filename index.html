<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="content-type" content="text/html" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>composer</title>
    <link href="abcjs-audio.css" media="all" rel="stylesheet" type="text/css" />
    <script src="abcjs-basic-min.js" type="text/javascript"></script>
    <style>
      #whole {
        display: flex;
      }
      h1 {
        width: 500px;
        margin: 10px auto;
      }
      #left {
        width: 400px;
        margin: 30px 20px 0 20px;
      }
      .abcjs-inline-audio {
        max-width: 770px;
      }
    </style>
  </head>
  <body>
    <h1>プログラミング　×　作曲</h1>

    <div id="whole">
      <div id="left">
        <textarea id="score" name="score" cols="50" rows="20">
X:1
T: Cooley's
M: 4/4
L: 1/8
R: reel
K: Emin
D2|:"Em"EB{c}BA B2 EB|~B2 AB dBAG|"D"FDAD BDAD|FDAD dAFD
| "Em"EBBA B2 EB|B2 AB defg|"D"afe^c dBAF|1"Em"DEFD E2 D2:|2"Em"DEFD E2 gf|| 
|:"Em"eB B2 efge|eB B2 gedB|"D"A2 FA DAFA|A2 FA defg
| "Em"eB B2 eBgB|eB B2 defg|"D"afe^c dBAF|1"Em"DEFD E2 gf:|2"Em"DEFD E4|]</textarea
        ><br />
        <button onclick="onRender(scoreObj); return false;">楽譜作成</button>
        <button onclick="onMidi(scoreObj); return false;">演奏</button>
        <p>（例）</p>
        <p>
          <a href="#" onclick="example(); return false;">Cooley's</a>
        </p>
      </div>
      <div>
        <div id="notation"></div>
        <div id="audio"></div>
      </div>
    </div>
    <script type="text/javascript">
      var scoreObj;

      //演奏
      function onMidi(obj) {
        if (ABCJS.synth.supportsAudio()) {
          var visualObj = ABCJS.renderAbc("notation", obj)[0];

          var synthControl = new ABCJS.synth.SynthController();
          synthControl.load("#audio", null, {
            displayRestart: true,
            displayPlay: true,
            displayProgress: true,
          });
          synthControl.setTune(visualObj, false);
        } else {
          document.querySelector("#audio").innerHTML =
            "<div class='audio-error'>Audio is not supported in this browser.</div>";
        }
      }

      //記譜
      function onRender(tune, params) {
        scoreObj = document.getElementById("score").value;

        if (!params) params = {};
        ABCJS.renderAbc("notation", tune, params);
        document.getElementById("audio").innerHTML = "";
      }
      var cooleys =
        'X:1\nT: Cooley\'s\nM: 4/4\nL: 1/8\nR: reel\nK: Emin\nD2|:"Em"EB{c}BA B2 EB|~B2 AB dBAG|"D"FDAD BDAD|FDAD dAFD|\n"Em"EBBA B2 EB|B2 AB defg|"D"afe^c dBAF|1"Em"DEFD E2 D2:|2"Em"DEFD E2 gf||\n|:"Em"eB B2 efge|eB B2 gedB|"D"A2 FA DAFA|A2 FA defg|\n"Em"eB B2 eBgB|eB B2 defg|"D"afe^c dBAF|1"Em"DEFD E2 gf:|2"Em"DEFD E4|]\n';

      function example() {
        onRender(cooleys);
        onMidi(cooleys);
      }
    </script>
  </body>
</html>
